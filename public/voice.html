<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨ Dreamscape AI - Voice Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Quicksand:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="css/enhance.css">
    <link rel="icon" type="image/png" href="../favicon.png">
    
    <!-- Watson Speech SDK -->
    <script src="https://cdn.jsdelivr.net/npm/ibm-watson@7.1.2/dist/speech-to-text.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2.3.1/dist/socket.io.js"></script>
    <style>
        /* Voice-specific styles */
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: rgba(20, 10, 30, 0.95);
            border-right: 1px solid rgba(157, 78, 221, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(157, 78, 221, 0.2);
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
        }

        .sidebar-section {
            padding: 15px 0;
            border-bottom: 1px solid rgba(157, 78, 221, 0.2);
        }

        .section-title {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .nav-link {
            display: block;
            padding: 10px 15px;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }

        .nav-link:hover {
            background: rgba(157, 78, 221, 0.1);
            color: var(--text-white);
        }

        .nav-link.active {
            background: rgba(157, 78, 221, 0.2);
            color: var(--text-white);
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 50px 30px 30px 30px;
            height: 100%;
            overflow-y: auto;
        }
        
        .page-header {
            width: 100%;
            max-width: 1200px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            min-width: 800px;
            max-width: 1200px;
            background: rgba(30, 15, 50, 0.15);
            border: 1px solid rgba(157, 78, 221, 0.2);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(5px);
            margin: 0 auto;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(15, 5, 25, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(157, 78, 221, 0.15);
            max-height: 60vh;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            margin-left: auto;
            margin-right: 0;
        }

        .ai-message {
            align-self: flex-start;
            background: rgba(50, 30, 80, 0.3);
            border: 1px solid rgba(157, 78, 221, 0.2);
            color: var(--text-light);
            margin-right: auto;
            margin-left: 0;
            display: flex;
            align-items: center;
        }

        .ai-message .speech-bubble {
            position: relative;
            display: inline-block;
            margin-right: 10px;
            width: 24px;
            height: 24px;
        }

        .ai-message .speech-bubble::before {
            content: '🔊';
            position: absolute;
            width: 100%;
            height: 100%;
            animation: pulsate 2s ease-out infinite;
        }

        @keyframes pulsate {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex-grow: 1;
            padding: 15px;
            border: 1px solid rgba(157, 78, 221, 0.3);
            border-radius: 10px;
            background: rgba(20, 10, 30, 0.3);
            color: var(--text-white);
            font-family: 'Quicksand', sans-serif;
            font-size: 16px;
            resize: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(157, 78, 221, 0.4);
        }

        .send-button {
            padding: 0 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
        }

        .voice-button {
            width: 50px;
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
        }

        .voice-button.recording {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-size: 14px;
        }

        select {
            width: 100%;
            padding: 10px 15px;
            background: rgba(30, 15, 50, 0.2);
            border: 1px solid rgba(157, 78, 221, 0.3);
            border-radius: 8px;
            color: var(--text-light);
            font-family: 'Quicksand', sans-serif;
            font-size: 14px;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(157, 78, 221, 0.4);
        }

        /* Background animations */
        .stars, .twinkling {
            position: fixed;
            width: 100%;
            height: 100%;
            display: block;
            top: 0;
            left: 0;
        }

        .stars {
            background: #000 url(../images/stars.png) repeat top center;
            z-index: -3;
        }

        .twinkling {
            background: transparent url(../images/twinkling.png) repeat top center;
            z-index: -2;
            animation: move-twinkle 200s linear infinite;
        }

        @keyframes move-twinkle {
            from {background-position: 0 0;}
            to {background-position: -10000px 5000px;}
        }

        .shooting-star {
            position: fixed;
            height: 2px;
            background: linear-gradient(90deg, white, transparent);
            animation: shoot 3s ease-out infinite;
        }

        @keyframes shoot {
            from {
                transform: translateX(-100%) translateY(0);
            }
            to {
                transform: translateX(200%) translateY(100vh);
            }
        }

        /* Loading/typing animation */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: rgba(157, 78, 221, 0.7);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.5);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Background elements -->
    <div class="stars"></div>
    <div class="twinkling"></div>

    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../favicon.png" alt="Dreamscape AI" class="sidebar-logo">
                <span>Creative Studio✨</span>
            </div>

            <div class="sidebar-section">
                <p class="section-title">📋 Navigation</p>
                <a href="../index.html" class="nav-link">🏠 Home</a>
                <a href="generate.html" class="nav-link">🌌 Generate Images</a>
                <a href="enhance.html" class="nav-link">✨ Enhance & Resize Images</a>
                <a href="artistic.html" class="nav-link">🎨 Artistic Effects</a>
                <a href="chat.html" class="nav-link">💬 Text Chat</a>
                <a href="voice.html" class="nav-link active">🎤 Voice Assistant</a>
            </div>

            <div class="sidebar-section">
                <p class="section-title">🎤 Voice Settings</p>
                <div class="control-group">
                    <label for="voiceModel">Voice Model</label>
                    <select id="voiceModel">
                        <option value="alloy">Alloy - Natural & Clear</option>
                        <option value="echo">Echo - Warm & Resonant</option>
                        <option value="fable">Fable - Expressive & Dynamic</option>
                        <option value="onyx">Onyx - Deep & Powerful</option>
                        <option value="nova">Nova - Bright & Energetic</option>
                        <option value="shimmer">Shimmer - Smooth & Melodic</option>
                        <option value="coral">Coral - Soft & Gentle</option>
                        <option value="verse">Verse - Poetic & Flowing</option>
                        <option value="ballad">Ballad - Musical & Rhythmic</option>
                        <option value="ash">Ash - Calm & Steady</option>
                        <option value="sage">Sage - Wise & Thoughtful</option>
                        <option value="amuch">Amuch - Friendly & Approachable</option>
                        <option value="dan">Dan - Professional & Clear</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="microphoneSelect">Microphone</label>
                    <select id="microphoneSelect">
                        <option value="">Loading microphones...</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="handsFreeToggle">
                        <input type="checkbox" id="handsFreeToggle">
                        🎧 Hands-free Mode
                    </label>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="page-header">
                <h1>✨ Voice Assistant</h1>
            </div>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be added here dynamically -->
                    <div class="message ai-message">
                        <span class="speech-bubble">🔊</span>
                        <span>Hello! I'm your AI voice assistant. Click the microphone button or start typing to chat with me.</span>
                    </div>
                </div>

                <div class="chat-input-container">
                    <textarea class="chat-input" id="messageInput" placeholder="Type your message here..." rows="1"></textarea>
                    <button class="voice-button" id="voiceButton">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="send-button" id="sendButton">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js"></script>
    <script>
        // Add shooting stars
        function createShootingStar() {
            const star = document.createElement('div');
            star.className = 'shooting-star';
            star.style.left = Math.random() * window.innerWidth + 'px';
            star.style.top = Math.random() * window.innerHeight/3 + 'px';
            star.style.width = Math.random() * 150 + 50 + 'px';
            document.body.appendChild(star);

            star.addEventListener('animationend', () => {
                star.remove();
            });
        }

        setInterval(createShootingStar, 2000);

        // Voice chat functionality
        const voiceButton = document.getElementById('voiceButton');
        const handsFreeToggle = document.getElementById('handsFreeToggle');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const voiceModel = document.getElementById('voiceModel');
        const microphoneSelect = document.getElementById('microphoneSelect');

        let isRecording = false;
        let recognition = null;

        // Initialize microphone selection
        if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
            navigator.mediaDevices.enumerateDevices()
                .then(devices => {
                    const audioInputs = devices.filter(device => device.kind === 'audioinput');
                    microphoneSelect.innerHTML = audioInputs.map(device => 
                        `<option value="${device.deviceId}">${device.label || `Microphone ${audioInputs.indexOf(device) + 1}`}</option>`
                    ).join('');
                })
                .catch(err => {
                    console.error('Error enumerating devices:', err);
                    microphoneSelect.innerHTML = '<option value="">Default Microphone</option>';
                });
        }

        // Initialize Web Speech API
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = () => {
                isRecording = true;
                voiceButton.classList.add('recording');
            };

            recognition.onend = () => {
                isRecording = false;
                voiceButton.classList.remove('recording');
                if (handsFreeToggle.checked) {
                    recognition.start();
                }
            };

            recognition.onresult = (event) => {
                const transcript = Array.from(event.results)
                    .map(result => result[0])
                    .map(result => result.transcript)
                    .join('');

                messageInput.value = transcript;
                
                if (event.results[0].isFinal) {
                    if (!handsFreeToggle.checked) {
                        recognition.stop();
                    }
                    sendMessage();
                }
            };
        }

        // Voice button click handler
        voiceButton.addEventListener('click', () => {
            if (!isRecording) {
                recognition.start();
            } else {
                recognition.stop();
            }
        });

        // Hands-free mode toggle
        handsFreeToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                recognition.start();
            } else {
                recognition.stop();
            }
        });

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'message ai-message typing-indicator';
            indicator.id = 'typing-indicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('span');
                indicator.appendChild(dot);
            }
            
            chatMessages.appendChild(indicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function addMessage(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            if (!isUser) {
                const bubbleSpan = document.createElement('span');
                bubbleSpan.className = 'speech-bubble';
                bubbleSpan.innerHTML = '🔊';
                messageDiv.appendChild(bubbleSpan);
            }
            
            const textSpan = document.createElement('span');
            textSpan.textContent = text;
            messageDiv.appendChild(textSpan);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                addMessage(message, true);
                messageInput.value = '';
                
                showTypingIndicator();

                try {
                    // Get selected voice model
                    const voice = voiceModel.value;
                    
                    // Send message to API and get response
                    const encodedText = encodeURIComponent(message);
                    const url = `https://text.pollinations.ai/${encodedText}`;
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const responseText = await response.text();
                    
                    removeTypingIndicator();
                    addMessage(responseText, false);

                    // Play response as audio
                    const audioUrl = `https://text.pollinations.ai/${encodeURIComponent(responseText)}?model=openai-audio&voice=${voice}`;
                    const audio = new Audio(audioUrl);
                    await audio.play();

                } catch (error) {
                    console.error('Error:', error);
                    removeTypingIndicator();
                    addMessage('Sorry, there was an error processing your request. Please try again.', false);
                }
            }
        }

        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html> 